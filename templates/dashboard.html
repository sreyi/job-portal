<!-- templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h2 class="mb-4">Welcome, {{ current_user.username }}!</h2>
<p class="lead text-muted">You are logged in as a {{ current_user.role.replace('_', ' ').capitalize() }}.</p>
<hr>

{% if current_user.role == 'job_seeker' %}
    <!-- Section 1: Your Applied Jobs -->
    <div class="mb-5">
        <h4 class="mb-3">Your Applied Jobs</h4>
        {% if applied_jobs %}
            <div class="row">
                {% for job in applied_jobs %}
                <div class="col-md-6 mb-4">
                    <div class="card job-listing p-4 h-100">
                        <h5 class="card-title">{{ job.title }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ job.company }}</h6>
                        <p class="card-text"><i class="bi bi-geo-alt-fill me-2"></i>{{ job.location }}</p>
                        <a href="{{ url_for('job_detail', job_id=job.id) }}" class="btn btn-outline-primary btn-sm mt-3 align-self-start">View Details</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info text-center" role="alert">
                You have not applied for any jobs yet.
            </div>
        {% endif %}
    </div>

    <!-- Section 2: Browse More Jobs -->
    <div>
        <h4 class="mb-3">Browse More Jobs</h4>
        {% if all_jobs %}
            <div class="row">
                {% for job in all_jobs %}
                <div class="col-md-6 mb-4">
                    <div class="card job-listing p-4 h-100">
                        <h5 class="card-title">{{ job.title }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ job.company }}</h6>
                        <p class="card-text"><i class="bi bi-geo-alt-fill me-2"></i>{{ job.location }}</p>
                        <a href="{{ url_for('job_detail', job_id=job.id) }}" class="btn btn-primary btn-sm mt-3 align-self-start">View Details</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info text-center" role="alert">
                There are no new job listings at the moment. Please check back later!
            </div>
        {% endif %}
    </div>
{% elif current_user.role == 'employer' %}
    <h4 class="mb-3">Your Posted Jobs</h4>
    <a href="{{ url_for('job_form') }}" class="btn btn-primary mb-3">Post a New Job</a>
    {% if jobs %}
        <div class="row">
            {% for job in jobs %}
            <div class="col-md-6 mb-4">
                <div class="card job-listing p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <h5 class="card-title mb-1">{{ job.title }}</h5>
                            <h6 class="card-subtitle text-muted">{{ job.company }}</h6>
                        </div>
                        <a href="{{ url_for('edit_job', job_id=job.id) }}" class="btn btn-outline-primary btn-sm">Edit</a>
                    </div>
                    <p class="card-text"><i class="bi bi-geo-alt-fill me-2"></i>{{ job.location }}</p>
                    <a href="{{ url_for('view_applicants', job_id=job.id) }}" class="btn btn-success btn-sm mt-3 align-self-start">View Applicants ({{ job.applications.count() }})</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info text-center" role="alert">
            You have not posted any jobs yet. <a href="{{ url_for('job_form') }}">Post your first job</a> today!
        </div>
    {% endif %}
{% elif current_user.role == 'admin' %}
    <h4 class="mb-3">All Job Listings</h4>
    {% if jobs %}
        <div class="row">
            {% for job in jobs %}
            <div class="col-md-6 mb-4">
                <div class="card job-listing p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <h5 class="card-title mb-1">{{ job.title }}</h5>
                            <h6 class="card-subtitle text-muted">{{ job.company }}</h6>
                        </div>
                        <a href="{{ url_for('view_applicants', job_id=job.id) }}" class="btn btn-success btn-sm">View Applicants</a>
                    </div>
                    <p class="card-text"><i class="bi bi-geo-alt-fill me-2"></i>{{ job.location }}</p>
                    <a href="{{ url_for('edit_job', job_id=job.id) }}" class="btn btn-primary btn-sm mt-3 align-self-start">Edit Job</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info text-center" role="alert">
            There are no jobs posted on the platform yet.
        </div>
    {% endif %}
{% endif %}
{% endblock %}
